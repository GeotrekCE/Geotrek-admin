{% extends "mapentity/mapentity_list.html" %}
{% load i18n mapentity_tags %}
{% load static %}

{% block change_style %}
    <script>
        style_others = window.SETTINGS.map.styles.others;
        window.SETTINGS.map.styles.others = function (feature) {
            if (feature.properties.draft) {
                return window.SETTINGS.map.styles.draftpath;
            }
            return style_others;
        };
    </script>
{% endblock change_style %}

{% block extrahead %}

    {% csrf_token %}

    <script type="text/javascript">

        $(function () {
            $('#btn-merge').click(function () {
                if ($('input[type="checkbox"][name="path\\[\\]"]:checked').length != 2) {
                    $('#btn-confirm').hide();
                    $('#confirm-merge .modal-body h4').html("{% trans 'Select two paths to merge them' %}");
                } else {
                    $('#confirm-merge .modal-body h4').html('{% trans "Are you sure you want to merge these paths ?" %}');
                    $('#btn-confirm').show();
                }
            });

            var pathDelete = "{% url 'core:multiple_path_delete' "0,0" %}";
            var pathsToDelete = [];
            $('#btn-delete').click(function () {
                for (const value of Object.values($('#objects-list input:checkbox:checked'))) {
                    pathsToDelete.push(value.value);
                }
                ;
                if (pathsToDelete.filter(Boolean).length != 0) {
                    window.location = pathDelete.replace('0,0', pathsToDelete.filter(Boolean).join(','));
                }
            });

            $('#btn-confirm').click(function () {
                $('#confirm-merge .modal-body h4').html($('#wait_lightbox').html());
                $('#btn-confirm').hide();

                $.post("{% url 'core:path-drf-merge-path' %}",
                    $('input:checkbox:checked').serialize() + '&' + $('input[name=csrfmiddlewaretoken]').serialize(),

                    function (response) {
                        $('#btn-confirm').show();

                        if (response.error) {
                            $('#confirm-merge .modal-body h4').html(response.error);
                            $('#btn-confirm').hide();
                        } else {
                            location.reload();
                        }
                    }
                );
            });

        });

    </script>

{% endblock %}

{% block mainactions %}

    {% if perms.core.add_path or perms.core.add_draft_path %}
        {{ block.super }}
    {% endif %}

{% endblock mainactions %}
