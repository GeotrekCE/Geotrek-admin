{% load i18n %}

{{ form.media }}

{% if form.bbox_city %}
      {{ form.bbox_city }}
{% endif %}

{% if form.bbox_district %}
      {{ form.bbox_district }}
{% endif %}


{% if form.bbox_restrictedarea %}
      {{ form.bbox_restrictedarea }}
{% endif %}

    <script type="text/javascript">
        window.addEventListener('entity:map:ready', function (event) {
            const map = event.detail.map.getMap();

            $('#id_bbox_city, #id_bbox_district, #id_bbox_restrictedarea').on('change', function () {
                const bboxval = $(this).val();

                // Clear other filters, but keep this one of course
                var self = this;
                $('#id_bbox_city, #id_bbox_district, #id_bbox_restrictedarea').each(function () {
                    if (self != this) {
                        $(this).val('');
                        $(this).removeClass('filter-set');
                    }
                });

                // Fit selected bbox, or whole map
                if (bboxval) {
                    var bbox = $.map(bboxval.split(','), parseFloat); // minx,miny,maxx,maxy
                    // MapLibre format: [[west, south], [east, north]] = [[minx, miny], [maxx, maxy]]
                    map.fitBounds([[bbox[0], bbox[1]], [bbox[2], bbox[3]]]);
                    $(this).addClass('filter-set');
                } else {
                    var maxBounds = map.getMaxBounds();
                    if (maxBounds) {
                        map.fitBounds(maxBounds);
                    }
                    $(this).removeClass('filter-set');
                }
            });
        });
    </script>
<!-- end land/bbox.html -->
